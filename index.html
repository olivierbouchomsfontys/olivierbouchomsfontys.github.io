<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <title>HackIT Vitality Living Lab</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/libs/bootstrap.css">
    <link rel="stylesheet" href="css/libs/bootstrap-grid.css">
    <link rel="stylesheet" href="css/libs/bootstrap-reboot.css">
    <link rel="stylesheet" href="css/libs/style.css">

    <meta name="theme-color" content="#fafafa">
</head>

<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Vitality Living Lab</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="cards.html">Home</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="container">
            <h1 class="title">Vitality Living Lab: data visualisation</h1>
            <h1>Health data</h1>
            <p>
                Discover trends and correlations by viewing and comparing health and fitness data.
            </p>
            <div class="select-dataset-container">
                <form id="select-dataset">
                    <div class="dataset-select">
                        <label> Dataset 1
                            <select id="dataset-one" class="select-primary" onchange="OnChangeDataSetOne()"></select>
                        </label>
                        <label>
                            Chart X as
                            <select class="select-primary" id="selectChartXAs"></select>
                        </label>
                        <label>
                            Chart Y as
                            <select class="select-primary" id="selectChartYAs"></select>
                        </label>
                        <label>
                            Chart type 1
                            <select class="select-primary" id="selectChartType"></select>
                        </label>
                    </div>

                    <div class="additional-dataset">
                        <label> Dataset 2
                            <select id="dataset-two" class="select-primary"  onchange="OnChangeDataSetTwo()" ></select>
                        </label>

                        <label>
                            Chart X as
                            <select class="select-primary" id="selectTwoChartXAs"></select>
                        </label>
                        <label>
                            Chart Y as
                            <select class="select-primary" id="selectTwoChartYAs"></select>
                        </label>
                        <label>
                            Chart type 2
                            <select class="select-primary" id="selectChartTypeSecond">
                                <option value="line">line</option>
                                <option value="bar">bar</option>
                                <option value="doughnut">doughnut</option>
                                <option value="pie">pie</option>
                            </select>
                        </label>
                    </div>

                    <button onclick="LoadCharts()" type="button" class="btn btn-primary">
                        Get charts
                    </button>
                </form>

            </div>
            <div id="loading-message"></div>
            <canvas id="chart1"></canvas>
            <div id="3dPlot1"></div>
        </div>
    </main>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="js/libs/bootstrap.js"></script>
    <script src="js/libs/bootstrap.bundle.js"></script>
    <script src="js/libs/bootstrap.js"></script>
    <script src="js/libs/bootstrap.bundle.js"></script>
    <script src="js/libs/Chart.min.js"></script>
    <script src="js/libs/d3.v6.min.js"></script>
    <script src="js/libs/plotly.v1.58.4.js"></script>
    <script src="js/libs/please.js"></script>
    <script src="js/model/dataset.js"></script>
    <script src="js/model/selectDataset.js"></script>
    <script src="js/model/threeDimensionalDataset.js"></script>
    <script src="js/model/graphType.js"></script>
    <script src="js/graphRenderer.js"></script>
    <script src="js/csvSelect.js"></script>
</body>

<script>
    const graphRenderer = new GraphRenderer();

    function LoadCharts() {
        const chartType = selectChartType.value;
        const chartTypeSecond = selectChartTypeSecond.value;
        const graphTypeSelector = document.getElementById("selectChartType")
        const selectChartXAsSelector = document.getElementById("selectChartXAs")
        const selectChartYAsSelector = document.getElementById("selectChartYAs")
        const selectTwoChartXAsSelector = document.getElementById("selectTwoChartXAs")
        const selectTwoChartYAsSelector = document.getElementById("selectTwoChartYAs")
        const dataGraphType = graphTypeSelector.options[graphTypeSelector.selectedIndex].getAttribute("data-graph-type");

        if (selectSecondElement.value === "") {
            // If the second dataset selector is not set, display normal graph
            const dataset = datasets.find(data => data.url === selectFirstElement.value)
            graphRenderer.renderGraphByCsv(dataset.url,selectChartYAsSelector.value, selectChartXAsSelector.value, document.getElementById("chart1"), chartType);

            if (dataGraphType === '2d') {
                graphRenderer.renderGraphByCsv(dataset.url, selectChartYAsSelector.value, selectChartXAsSelector.value, document.getElementById("chart1"), chartType);
            } else {
                graphRenderer.render3dPlotByCsv(dataset.url, document.getElementById("3dPlot1"), dataset.xKey, dataset.yKey, dataset.zKey, chartType);
            }
        } else {
            const chosenDatasets = [];

            datasetOne  =datasets.find(data => data.url === selectFirstElement.value)         
            chosenDatasets.push(new selectDataset(datasetOne,selectChartXAsSelector.value, selectChartYAsSelector.value))
            datasetTwo  =datasets.find(data => data.url === selectSecondElement.value)         
            chosenDatasets.push(new selectDataset(datasetTwo,selectTwoChartXAsSelector.value, selectTwoChartYAsSelector.value))
            const graphTypes = [chartType, chartTypeSecond];

            graphRenderer.renderMixedGraphByCsv(chosenDatasets, document.getElementById("chart1"), graphTypes)
        }
    }



    function updateSelectAxes() {
        const dataset = datasets.find(data => data.url === selectFirstElement.value)
        let htmlX = "";
        let htmlY = "";
        for (let graphType of dataset.headers) {
            htmlX += "<option data-graph-x='" + graphType + "' value='" + graphType + "'>" + graphType + "</option>"
            htmlY += "<option data-graph-y='" + graphType + "' value='" + graphType + "'>" + graphType + "</option>"
        }

        document.getElementById("selectChartXAs").innerHTML = htmlX;
        document.getElementById("selectChartYAs").innerHTML = htmlY;
    }

function updateSelectTwoAxes() {
    const dataset = datasets.find(data => data.url === selectSecondElement.value)
    let htmlX = "";
    let htmlY = "";
    for (let graphType of dataset.headers) {
        htmlX += "<option data-graph-x='" + graphType + "' value='" + graphType + "'>" + graphType + "</option>"
        htmlY += "<option data-graph-y='" + graphType + "' value='" + graphType + "'>" + graphType + "</option>"
    }

    document.getElementById("selectTwoChartXAs").innerHTML = htmlX;
    document.getElementById("selectTwoChartYAs").innerHTML = htmlY;
}


    function OnChangeDataSetTwo(){
        updateSelectTwoAxes();
    }


    function OnChangeDataSetOne() {
        updateSelectChartType();
        updateSelectAxes();
    }

    function updateSelectChartType() {
        const knownGraphTypes = [
            new GraphType("line", "2d"),
            new GraphType("bar", "2d"),
            new GraphType("doughnut", "2d"),
            new GraphType("pie", "2d"),
            new GraphType("scatter3d", "3d"),
        ];

        const dataSetType = selectFirstElement.options[selectFirstElement.selectedIndex].getAttribute("data-set-type");
        const support3D = dataSetType === ThreeDimensionalDataSet.name;
        let html = ""
        for (let graphType of knownGraphTypes) {

            if (!support3D && graphType.type === '3d') {
                continue;
            }

            html += "<option data-graph-type='" + graphType.type + "' value='" + graphType.name + "'>" + graphType.name + "</option>"
        }
        document.getElementById("selectChartType").innerHTML = html;
    }

</script>

</html>